# REST API ìë™ ìƒì„±ê¸° - ì‹¤í–‰ ê°€ëŠ¥í•œ FastAPI êµ¬í˜„
# pip install fastapi uvicorn pydantic

from datetime import datetime
from enum import Enum
from typing import List, Optional

import uvicorn
from fastapi import FastAPI, HTTPException
from fastapi.responses import HTMLResponse
from pydantic import BaseModel, Field

app = FastAPI(title="REST API Generator", description="AI ê¸°ë°˜ REST API ìë™ ìƒì„±ê¸°")

# ============================================================================
# 1. ë°ì´í„° ëª¨ë¸ ì •ì˜
# ============================================================================


class HTTPMethod(str, Enum):
    GET = "GET"
    POST = "POST"
    PUT = "PUT"
    DELETE = "DELETE"
    PATCH = "PATCH"


class Framework(str, Enum):
    FASTAPI = "fastapi"
    FLASK = "flask"
    EXPRESS = "express"


class Database(str, Enum):
    POSTGRESQL = "postgresql"
    MYSQL = "mysql"
    MONGODB = "mongodb"
    SQLITE = "sqlite"


class AuthMethod(str, Enum):
    NONE = "none"
    JWT = "jwt"
    OAUTH2 = "oauth2"
    API_KEY = "api-key"


class EndpointModel(BaseModel):
    path: str = Field(..., description="API ê²½ë¡œ")
    method: HTTPMethod = Field(..., description="HTTP ë©”ì„œë“œ")
    description: str = Field(..., description="ì—”ë“œí¬ì¸íŠ¸ ì„¤ëª…")
    parameters: Optional[str] = Field(None, description="íŒŒë¼ë¯¸í„°")
    request_body: Optional[str] = Field(None, description="ìš”ì²­ ë³¸ë¬¸")
    responses: Optional[str] = Field(None, description="ì‘ë‹µ")
    tags: List[str] = Field(default_factory=list, description="íƒœê·¸")


class APISpecModel(BaseModel):
    name: str = Field(..., description="API ì´ë¦„")
    description: str = Field(..., description="API ì„¤ëª…")
    version: str = Field(default="1.0.0", description="ë²„ì „")
    framework: Framework = Field(default=Framework.FASTAPI, description="í”„ë ˆì„ì›Œí¬")
    database: Database = Field(default=Database.POSTGRESQL, description="ë°ì´í„°ë² ì´ìŠ¤")
    authentication: AuthMethod = Field(default=AuthMethod.JWT, description="ì¸ì¦ ë°©ì‹")
    endpoints: List[EndpointModel] = Field(..., description="ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡")


class GeneratedCodeResponse(BaseModel):
    main_code: str
    models: str
    database: str
    requirements: str
    documentation: str


# ============================================================================
# 2. ì½”ë“œ ìƒì„± ì—”ì§„
# ============================================================================


class FastAPICodeGenerator:
    def generate_api(self, spec: APISpecModel) -> GeneratedCodeResponse:
        """API ìŠ¤í™ì„ ë°”íƒ•ìœ¼ë¡œ ì™„ì „í•œ ì½”ë“œ ìƒì„±"""
        # í•„ìš” í•¨ìˆ˜: _generate_main_code, _generate_models, _generate_database_code, _generate_requirements, _generate_documentation
        # Returns: GeneratedCodeResponse

        main_code = self._generate_main_code(spec)
        models = self._generate_models(spec)
        database = self._generate_database_code(spec)
        requirements = self._generate_requirements(spec)
        documentation = self._generate_documentation(spec)

        return GeneratedCodeResponse(
            main_code=main_code,
            models=models,
            database=database,
            requirements=requirements,
            documentation=documentation,
        )

    def _generate_main_code(self, spec: APISpecModel) -> str:
        """RestAPI ê¸°ë°˜, ë©”ì¸ FastAPI ì•± ì½”ë“œ ìƒì„±
        Args:
            spec (APISpecModel): API ìŠ¤í™ ëª¨ë¸
        Returns:
            str: FastAPI ì•± ì½”ë“œ
        """

        endpoints_code = ""
        for endpoint in spec.endpoints:
            endpoints_code += self._generate_endpoint_code(endpoint, spec)

        auth_imports = ""
        auth_middleware = ""
        if spec.authentication != AuthMethod.NONE:
            auth_imports = """
from fastapi.security import HTTPBearer
from fastapi.middleware.cors import CORSMiddleware"""
            auth_middleware = """
# CORS ë° ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

security = HTTPBearer()"""

        return f'''"""
{spec.name} API
{spec.description}
Version: {spec.version}
Generated by REST API Generator
"""

from fastapi import FastAPI, HTTPException, Depends, status
from typing import List, Optional, Dict, Any
from pydantic import BaseModel
from datetime import datetime
import uvicorn{auth_imports}

# FastAPI ì•± ìƒì„±
app = FastAPI(
    title="{spec.name}",
    description="{spec.description}",
    version="{spec.version}",
    docs_url="/docs",
    redoc_url="/redoc"
)
{auth_middleware}

# ê¸°ë³¸ ì‘ë‹µ ëª¨ë¸
class APIResponse(BaseModel):
    success: bool = True
    message: str = "Success"
    data: Optional[Dict[Any, Any]] = None

@app.get("/")
async def root():
    """API ë£¨íŠ¸ ì—”ë“œí¬ì¸íŠ¸"""
    return APIResponse(
        message="Welcome to {spec.name} API",
        data={{"version": "{spec.version}", "docs_url": "/docs"}}
    )

@app.get("/health")
async def health_check():
    """í—¬ìŠ¤ ì²´í¬ ì—”ë“œí¬ì¸íŠ¸"""
    return APIResponse(
        message="API is healthy",
        data={{"timestamp": datetime.now().isoformat(), "service": "{spec.name}"}}
    )

{endpoints_code}

if __name__ == "__main__":
    uvicorn.run("main:app", host="0.0.0.0", port=8000, reload=True)
'''

    def _generate_endpoint_code(
        self, endpoint: EndpointModel, spec: APISpecModel
    ) -> str:
        """ê°œë³„ ì—”ë“œí¬ì¸íŠ¸ ì½”ë“œ ìƒì„±.
        ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í¬í•¨í•œ FastAPI ì—”ë“œí¬ì¸íŠ¸ ì½”ë“œ ìƒì„±.
        Args:
            endpoint (EndpointModel): ì—”ë“œí¬ì¸íŠ¸ ëª¨ë¸
            spec (APISpecModel): API ìŠ¤í™ ëª¨ë¸
        Returns:
            str: ì—”ë“œí¬ì¸íŠ¸ ì½”ë“œ
        """
        method = endpoint.method.lower()
        function_name = self._path_to_function_name(endpoint.path, endpoint.method)

        # ê²½ë¡œ íŒŒë¼ë¯¸í„° ì¶”ì¶œ
        path_params = self._extract_path_params(endpoint.path)
        params_str = ""
        for param in path_params:
            params_str += f", {param}: int"

        # ìš”ì²­ ë³¸ë¬¸ì´ í•„ìš”í•œ ë©”ì„œë“œ
        if endpoint.method in ["POST", "PUT", "PATCH"]:
            params_str += ", request_data: Dict[Any, Any] = {}"

        # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìƒì„±
        business_logic = self._generate_business_logic(endpoint, path_params)

        return f'''
@app.{method}("{endpoint.path}", tags={endpoint.tags or ["default"]})
async def {function_name}({params_str.lstrip(", ") if params_str else ""}):
    """
    {endpoint.description}
    
    Parameters: {endpoint.parameters or "No parameters"}
    Returns: {endpoint.responses or "API response"}
    """
    try:
{business_logic}
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"Internal server error: {{str(e)}}"
        )
'''

    def _generate_models(self, spec: APISpecModel) -> str:
        """ë°ì´í„° ëª¨ë¸ ì½”ë“œ ìƒì„±
        Args:
            spec (APISpecModel): API ìŠ¤í™ ëª¨ë¸
        Returns:
            str: Pydantic ëª¨ë¸ ì½”ë“œ
        """
        return f'''"""
{spec.name} ë°ì´í„° ëª¨ë¸
Pydantic ëª¨ë¸ ì •ì˜
"""

from pydantic import BaseModel, Field, EmailStr
from typing import Optional, List, Dict, Any
from datetime import datetime
from enum import Enum

# ============================================================================
# ê¸°ë³¸ ëª¨ë¸ë“¤
# ============================================================================

class UserBase(BaseModel):
    username: str = Field(..., min_length=3, max_length=50)
    email: str = Field(..., description="ì‚¬ìš©ì ì´ë©”ì¼")

class UserCreate(UserBase):
    password: str = Field(..., min_length=8, description="ë¹„ë°€ë²ˆí˜¸")

class UserResponse(UserBase):
    id: int
    is_active: bool = True
    created_at: datetime
    
    class Config:
        from_attributes = True

class ProductBase(BaseModel):
    name: str = Field(..., min_length=1, max_length=200)
    description: Optional[str] = None
    price: float = Field(..., gt=0)
    stock_quantity: int = Field(default=0, ge=0)

class ProductCreate(ProductBase):
    category_id: Optional[int] = None

class ProductResponse(ProductBase):
    id: int
    category_id: Optional[int] = None
    is_active: bool = True
    created_at: datetime
    
    class Config:
        from_attributes = True

class CategoryBase(BaseModel):
    name: str = Field(..., min_length=1, max_length=100)
    description: Optional[str] = None

class CategoryResponse(CategoryBase):
    id: int
    created_at: datetime
    product_count: int = 0
    
    class Config:
        from_attributes = True

class OrderBase(BaseModel):
    user_id: int
    total_amount: float = Field(..., gt=0)
    status: str = Field(default="pending")

class OrderResponse(OrderBase):
    id: str
    order_date: datetime
    items: List[Dict[str, Any]] = []
    
    class Config:
        from_attributes = True

# ì¸ì¦ ê´€ë ¨ ëª¨ë¸
class Token(BaseModel):
    access_token: str
    token_type: str = "bearer"

class LoginRequest(BaseModel):
    username: str
    password: str

# ê³µí†µ ì‘ë‹µ ëª¨ë¸
class PaginatedResponse(BaseModel):
    items: List[Dict[str, Any]]
    total: int
    page: int = 1
    size: int = 10
    pages: int

    def calculate_pages(self):
        self.pages = (self.total + self.size - 1) // self.size
        return self
'''

    def _generate_database_code(self, spec: APISpecModel) -> str:
        """MongoDB ë˜ëŠ” SQLAlchemy ê¸°ë°˜ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ì½”ë“œ ìƒì„±
        Args:
            spec (APISpecModel): API ìŠ¤í™ ëª¨ë¸
        Returns:
            str: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ì½”ë“œ
        """

        db_configs = {
            "postgresql": "postgresql://user:password@localhost/dbname",
            "mysql": "mysql://user:password@localhost/dbname",
            "sqlite": "sqlite:///./app.db",
            "mongodb": "mongodb://localhost:27017/dbname",
        }

        db_url = db_configs.get(spec.database.value, db_configs["sqlite"])

        if spec.database == Database.MONGODB:
            return f'''"""
MongoDB ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
"""

from motor.motor_asyncio import AsyncIOMotorClient
from typing import Optional
import os

# MongoDB ì—°ê²° ì„¤ì •
DATABASE_URL = os.getenv("DATABASE_URL", "{db_url}")
client: Optional[AsyncIOMotorClient] = None

async def connect_to_mongo():
    """MongoDB ì—°ê²°"""
    global client
    client = AsyncIOMotorClient(DATABASE_URL)

async def close_mongo_connection():
    """MongoDB ì—°ê²° ì¢…ë£Œ"""
    global client
    if client:
        client.close()

def get_database():
    """ë°ì´í„°ë² ì´ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜"""
    return client.get_default_database()

# ì»¬ë ‰ì…˜ ì •ì˜
def get_users_collection():
    db = get_database()
    return db.users

def get_products_collection():
    db = get_database()
    return db.products

def get_categories_collection():
    db = get_database()
    return db.categories
'''
        else:
            return f'''"""
{spec.database.value} ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
SQLAlchemy ê¸°ë°˜
"""

from sqlalchemy import create_engine, Column, Integer, String, DateTime, Boolean, Float, Text
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker, Session
from typing import Generator
from datetime import datetime
import os

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
DATABASE_URL = os.getenv("DATABASE_URL", "{db_url}")

# SQLAlchemy ì„¤ì •
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
Base = declarative_base()

# ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸
class User(Base):
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True, index=True)
    username = Column(String(50), unique=True, index=True, nullable=False)
    email = Column(String(100), unique=True, index=True, nullable=False)
    password_hash = Column(String(255), nullable=False)
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)

class Product(Base):
    __tablename__ = "products"
    
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(200), nullable=False, index=True)
    description = Column(Text)
    price = Column(Float, nullable=False)
    stock_quantity = Column(Integer, default=0)
    category_id = Column(Integer)
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)

class Category(Base):
    __tablename__ = "categories"
    
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(100), unique=True, nullable=False)
    description = Column(Text)
    created_at = Column(DateTime, default=datetime.utcnow)

def get_db() -> Generator:
    """ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ ì˜ì¡´ì„±"""
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

def init_db():
    """ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”"""
    Base.metadata.create_all(bind=engine)

def create_sample_data():
    """ìƒ˜í”Œ ë°ì´í„° ìƒì„±"""
    db = SessionLocal()
    try:
        # ì¹´í…Œê³ ë¦¬ ìƒì„±
        if not db.query(Category).first():
            categories = [
                Category(name="Electronics", description="ì „ìì œí’ˆ"),
                Category(name="Books", description="ë„ì„œ"),
                Category(name="Clothing", description="ì˜ë¥˜"),
            ]
            for category in categories:
                db.add(category)
            db.commit()
            
        # ìƒí’ˆ ìƒì„±
        if not db.query(Product).first():
            products = [
                Product(name="ìŠ¤ë§ˆíŠ¸í°", description="ìµœì‹  ìŠ¤ë§ˆíŠ¸í°", price=799.99, stock_quantity=50, category_id=1),
                Product(name="í”„ë¡œê·¸ë˜ë° ì±…", description="Python í•™ìŠµì„œ", price=29.99, stock_quantity=100, category_id=2),
                Product(name="í‹°ì…”ì¸ ", description="í¸ì•ˆí•œ ë©´ í‹°ì…”ì¸ ", price=19.99, stock_quantity=200, category_id=3),
            ]
            for product in products:
                db.add(product)
            db.commit()
            
    except Exception as e:
        print(f"ìƒ˜í”Œ ë°ì´í„° ìƒì„± ì˜¤ë¥˜: {{e}}")
        db.rollback()
    finally:
        db.close()
'''

    def _generate_requirements(self, spec: APISpecModel) -> str:
        """requirements.txt ìƒì„±"""
        base_requirements = [
            "fastapi==0.104.1",
            "uvicorn[standard]==0.24.0",
            "pydantic==2.5.0",
        ]

        if spec.database == Database.MONGODB:
            base_requirements.append("motor==3.3.2")
        else:
            base_requirements.extend(["sqlalchemy==2.0.23", "alembic==1.13.0"])

        if spec.database == Database.POSTGRESQL:
            base_requirements.append("psycopg2-binary==2.9.9")
        elif spec.database == Database.MYSQL:
            base_requirements.append("pymysql==1.1.0")

        if spec.authentication != AuthMethod.NONE:
            base_requirements.extend(
                ["python-jose[cryptography]==3.3.0", "passlib[bcrypt]==1.7.4"]
            )

        return "\\n".join(base_requirements)

    def _generate_documentation(self, spec: APISpecModel) -> str:
        """API ë¬¸ì„œ ìƒì„±"""
        endpoints_doc = ""
        for endpoint in spec.endpoints:
            endpoints_doc += f"""
### {endpoint.method} {endpoint.path}

**ì„¤ëª…:** {endpoint.description}

**íŒŒë¼ë¯¸í„°:** {endpoint.parameters or "ì—†ìŒ"}

**ìš”ì²­ ë³¸ë¬¸:**
```json
{endpoint.request_body or "ì—†ìŒ"}
```

**ì‘ë‹µ:**
```json
{endpoint.responses or "í‘œì¤€ API ì‘ë‹µ"}
```

---
"""

        return f"""# {spec.name} API ë¬¸ì„œ

## ê°œìš”
{spec.description}

- **ë²„ì „:** {spec.version}
- **í”„ë ˆì„ì›Œí¬:** {spec.framework.value}
- **ë°ì´í„°ë² ì´ìŠ¤:** {spec.database.value}
- **ì¸ì¦:** {spec.authentication.value}

## ë¹ ë¥¸ ì‹œì‘

### 1. ì„¤ì¹˜
```bash
pip install -r requirements.txt
```

### 2. ì‹¤í–‰
```bash
python main.py
```

### 3. API ë¬¸ì„œ í™•ì¸
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## API ì—”ë“œí¬ì¸íŠ¸

{endpoints_doc}

## ì‚¬ìš© ì˜ˆì‹œ

### ê¸°ë³¸ ìš”ì²­
```bash
curl -X GET "http://localhost:8000/" -H "accept: application/json"
```

### í—¬ìŠ¤ ì²´í¬
```bash
curl -X GET "http://localhost:8000/health" -H "accept: application/json"
```

## ê°œë°œ ì •ë³´

ì´ APIëŠ” REST API Generatorì— ì˜í•´ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

- ìƒì„± ì‹œê°„: {datetime.now().isoformat()}
- í”„ë ˆì„ì›Œí¬: FastAPI
- ë¬¸ì„œí™”: ìë™ ìƒì„± (OpenAPI/Swagger)

## ë‹¤ìŒ ë‹¨ê³„

1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì •
2. ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„
3. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€
4. í…ŒìŠ¤íŠ¸ ì‘ì„±
5. ë°°í¬ ì„¤ì •
"""

    def _path_to_function_name(self, path: str, method: str) -> str:
        """ê²½ë¡œë¥¼ í•¨ìˆ˜ëª…ìœ¼ë¡œ ë³€í™˜"""
        import re

        # /api/users/{id} -> get_users_by_id
        parts = path.strip("/").split("/")
        name_parts = [method.lower()]

        for part in parts:
            if part.startswith("{") and part.endswith("}"):
                name_parts.extend(["by", part[1:-1]])
            elif part != "api":
                name_parts.append(re.sub(r"[^a-zA-Z0-9]", "_", part))

        return "_".join(name_parts)

    def _extract_path_params(self, path: str) -> List[str]:
        """ê²½ë¡œì—ì„œ íŒŒë¼ë¯¸í„° ì¶”ì¶œ"""
        import re

        return re.findall(r"\\{([^}]+)\\}", path)

    def _generate_business_logic(
        self, endpoint: EndpointModel, path_params: List[str]
    ) -> str:
        """ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìƒì„±"""
        if endpoint.method == "GET":
            if path_params:
                param_name = path_params[0]
                return f"""        # íŠ¹ì • ë¦¬ì†ŒìŠ¤ ì¡°íšŒ
        resource_id = {param_name}
        
        # TODO: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ IDë¡œ ì¡°íšŒí•˜ëŠ” ë¡œì§ êµ¬í˜„
        # ì˜ˆì‹œ: resource = db.query(Model).filter(Model.id == resource_id).first()
        
        mock_data = {{
            "id": resource_id,
            "message": "Resource found",
            "timestamp": datetime.now().isoformat()
        }}
        
        return APIResponse(
            message="Resource retrieved successfully",
            data=mock_data
        )"""
            else:
                return """        # ë¦¬ì†ŒìŠ¤ ëª©ë¡ ì¡°íšŒ
        # TODO: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ëª©ë¡ ì¡°íšŒí•˜ëŠ” ë¡œì§ êµ¬í˜„
        # ì˜ˆì‹œ: resources = db.query(Model).all()
        
        mock_data = [
            {"id": 1, "name": "Sample Item 1"},
            {"id": 2, "name": "Sample Item 2"},
            {"id": 3, "name": "Sample Item 3"}
        ]
        
        return APIResponse(
            message="Resources retrieved successfully",
            data={"items": mock_data, "total": len(mock_data)}
        )"""

        elif endpoint.method == "POST":
            return """        # ìƒˆ ë¦¬ì†ŒìŠ¤ ìƒì„±
        # TODO: ì…ë ¥ ë°ì´í„° ê²€ì¦ ë° ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ë¡œì§ êµ¬í˜„
        # ì˜ˆì‹œ: new_resource = Model(**request_data)
        #       db.add(new_resource)
        #       db.commit()
        
        mock_id = 123
        
        return APIResponse(
            message="Resource created successfully",
            data={"id": mock_id, "created_at": datetime.now().isoformat()}
        )"""

        elif endpoint.method == "PUT":
            if path_params:
                param_name = path_params[0]
                return f"""        # ë¦¬ì†ŒìŠ¤ ì—…ë°ì´íŠ¸
        resource_id = {param_name}
        
        # TODO: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¦¬ì†ŒìŠ¤ ì°¾ê¸° ë° ì—…ë°ì´íŠ¸ ë¡œì§ êµ¬í˜„
        # ì˜ˆì‹œ: resource = db.query(Model).filter(Model.id == resource_id).first()
        #       if not resource:
        #           raise HTTPException(status_code=404, detail="Resource not found")
        #       for key, value in request_data.items():
        #           setattr(resource, key, value)
        #       db.commit()
        
        return APIResponse(
            message="Resource updated successfully",
            data={{"id": resource_id, "updated_at": datetime.now().isoformat()}}
        )"""

        elif endpoint.method == "DELETE":
            if path_params:
                param_name = path_params[0]
                return f"""        # ë¦¬ì†ŒìŠ¤ ì‚­ì œ
        resource_id = {param_name}
        
        # TODO: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¦¬ì†ŒìŠ¤ ì‚­ì œ ë¡œì§ êµ¬í˜„
        # ì˜ˆì‹œ: resource = db.query(Model).filter(Model.id == resource_id).first()
        #       if not resource:
        #           raise HTTPException(status_code=404, detail="Resource not found")
        #       db.delete(resource)
        #       db.commit()
        
        return APIResponse(
            message="Resource deleted successfully",
            data={{"id": resource_id, "deleted_at": datetime.now().isoformat()}}
        )"""

        return """        # ê¸°ë³¸ ë¡œì§
        return APIResponse(
            message="Operation completed successfully",
            data={"timestamp": datetime.now().isoformat()}
        )"""


# ============================================================================
# 3. ì˜ˆì œ ë°ì´í„°
# ============================================================================

# ì˜ˆì œ 1: ì‚¬ìš©ì ê´€ë¦¬ ì‹œìŠ¤í…œ
USER_MANAGEMENT_EXAMPLE = {
    "name": "User Management API",
    "description": "ì‚¬ìš©ì ë“±ë¡, ì¸ì¦, í”„ë¡œí•„ ê´€ë¦¬ë¥¼ ìœ„í•œ REST API",
    "version": "1.0.0",
    "framework": "fastapi",
    "database": "postgresql",
    "authentication": "jwt",
    "endpoints": [
        {
            "path": "/api/auth/register",
            "method": "POST",
            "description": "ìƒˆ ì‚¬ìš©ì ë“±ë¡",
            "parameters": "ì—†ìŒ",
            "request_body": '{"username": "testuser", "email": "test@example.com", "password": "password123"}',
            "responses": '{"success": true, "message": "User created", "data": {"id": 1, "username": "testuser"}}',
            "tags": ["authentication"],
        },
        {
            "path": "/api/auth/login",
            "method": "POST",
            "description": "ì‚¬ìš©ì ë¡œê·¸ì¸",
            "parameters": "ì—†ìŒ",
            "request_body": '{"username": "testuser", "password": "password123"}',
            "responses": '{"access_token": "jwt_token_here", "token_type": "bearer"}',
            "tags": ["authentication"],
        },
        {
            "path": "/api/users",
            "method": "GET",
            "description": "ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ",
            "parameters": "page, limit (ì„ íƒì‚¬í•­)",
            "request_body": "ì—†ìŒ",
            "responses": '{"success": true, "data": {"items": [], "total": 10}}',
            "tags": ["users"],
        },
        {
            "path": "/api/users/{user_id}",
            "method": "GET",
            "description": "íŠ¹ì • ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ",
            "parameters": "user_id: ì‚¬ìš©ì ID",
            "request_body": "ì—†ìŒ",
            "responses": '{"success": true, "data": {"id": 1, "username": "testuser", "email": "test@example.com"}}',
            "tags": ["users"],
        },
    ],
}

# ì˜ˆì œ 2: ë¸”ë¡œê·¸ ì‹œìŠ¤í…œ
BLOG_SYSTEM_EXAMPLE = {
    "name": "Blog System API",
    "description": "ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ì‘ì„±, ëŒ“ê¸€, ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ API",
    "version": "1.2.0",
    "framework": "fastapi",
    "database": "mysql",
    "authentication": "jwt",
    "endpoints": [
        {
            "path": "/api/posts",
            "method": "GET",
            "description": "ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ëª©ë¡ ì¡°íšŒ",
            "parameters": "page, category, search (ì„ íƒì‚¬í•­)",
            "request_body": "ì—†ìŒ",
            "responses": '{"success": true, "data": {"items": [], "total": 50, "page": 1}}',
            "tags": ["posts"],
        },
        {
            "path": "/api/posts",
            "method": "POST",
            "description": "ìƒˆ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ì‘ì„±",
            "parameters": "ì¸ì¦ í•„ìš”",
            "request_body": '{"title": "My Blog Post", "content": "Post content here", "category_id": 1}',
            "responses": '{"success": true, "data": {"id": 1, "title": "My Blog Post", "slug": "my-blog-post"}}',
            "tags": ["posts"],
        },
        {
            "path": "/api/posts/{post_id}",
            "method": "GET",
            "description": "íŠ¹ì • ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ì¡°íšŒ",
            "parameters": "post_id: í¬ìŠ¤íŠ¸ ID",
            "request_body": "ì—†ìŒ",
            "responses": '{"success": true, "data": {"id": 1, "title": "Post Title", "content": "Full content", "comments": []}}',
            "tags": ["posts"],
        },
        {
            "path": "/api/categories",
            "method": "GET",
            "description": "ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¡°íšŒ",
            "parameters": "ì—†ìŒ",
            "request_body": "ì—†ìŒ",
            "responses": '{"success": true, "data": [{"id": 1, "name": "Technology", "post_count": 15}]}',
            "tags": ["categories"],
        },
    ],
}

# ì˜ˆì œ 3: ì „ììƒê±°ë˜ API
ECOMMERCE_EXAMPLE = {
    "name": "E-commerce API",
    "description": "ì˜¨ë¼ì¸ ì‡¼í•‘ëª°ì„ ìœ„í•œ ì™„ì „í•œ ì „ììƒê±°ë˜ API",
    "version": "2.0.0",
    "framework": "fastapi",
    "database": "postgresql",
    "authentication": "jwt",
    "endpoints": [
        {
            "path": "/api/products",
            "method": "GET",
            "description": "ìƒí’ˆ ëª©ë¡ ì¡°íšŒ",
            "parameters": "category, min_price, max_price, search",
            "request_body": "ì—†ìŒ",
            "responses": '{"success": true, "data": {"items": [], "total": 200, "filters": {}}}',
            "tags": ["products"],
        },
        {
            "path": "/api/products/{product_id}",
            "method": "GET",
            "description": "ìƒí’ˆ ìƒì„¸ ì •ë³´ ì¡°íšŒ",
            "parameters": "product_id: ìƒí’ˆ ID",
            "request_body": "ì—†ìŒ",
            "responses": '{"success": true, "data": {"id": 1, "name": "Product Name", "price": 99.99, "images": []}}',
            "tags": ["products"],
        },
        {
            "path": "/api/cart",
            "method": "GET",
            "description": "ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ",
            "parameters": "ì¸ì¦ í•„ìš”",
            "request_body": "ì—†ìŒ",
            "responses": '{"success": true, "data": {"items": [], "total_amount": 199.99, "item_count": 3}}',
            "tags": ["cart"],
        },
        {
            "path": "/api/cart/items",
            "method": "POST",
            "description": "ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆ ì¶”ê°€",
            "parameters": "ì¸ì¦ í•„ìš”",
            "request_body": '{"product_id": 1, "quantity": 2}',
            "responses": '{"success": true, "message": "Item added to cart", "data": {"cart_total": 149.99}}',
            "tags": ["cart"],
        },
        {
            "path": "/api/orders",
            "method": "POST",
            "description": "ì£¼ë¬¸ ìƒì„±",
            "parameters": "ì¸ì¦ í•„ìš”",
            "request_body": '{"items": [{"product_id": 1, "quantity": 2}], "shipping_address": {}}',
            "responses": '{"success": true, "data": {"order_id": "ORD-001", "total_amount": 199.99, "status": "pending"}}',
            "tags": ["orders"],
        },
    ],
}

# ============================================================================
# 4. API ì—”ë“œí¬ì¸íŠ¸
# ============================================================================

# ì „ì—­ ì½”ë“œ ìƒì„±ê¸° ì¸ìŠ¤í„´ìŠ¤
code_generator = FastAPICodeGenerator()


@app.post("/api/generate", response_model=GeneratedCodeResponse)
async def generate_api_code(spec: APISpecModel):
    """API ìŠ¤í™ì„ ë°”íƒ•ìœ¼ë¡œ ì™„ì „í•œ ì½”ë“œ ìƒì„±"""
    try:
        result = code_generator.generate_api(spec)
        return result
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"ì½”ë“œ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")


@app.get("/api/examples")
async def get_examples():
    """ì‚¬ìš© ê°€ëŠ¥í•œ ì˜ˆì œ ëª©ë¡ ë°˜í™˜"""
    return {
        "examples": [
            {
                "id": "user_management",
                "name": "ì‚¬ìš©ì ê´€ë¦¬ ì‹œìŠ¤í…œ",
                "description": "ì‚¬ìš©ì ë“±ë¡, ì¸ì¦, í”„ë¡œí•„ ê´€ë¦¬",
                "endpoints_count": len(USER_MANAGEMENT_EXAMPLE["endpoints"]),
                "framework": "FastAPI",
                "database": "PostgreSQL",
            },
            {
                "id": "blog_system",
                "name": "ë¸”ë¡œê·¸ ì‹œìŠ¤í…œ",
                "description": "í¬ìŠ¤íŠ¸, ëŒ“ê¸€, ì¹´í…Œê³ ë¦¬ ê´€ë¦¬",
                "endpoints_count": len(BLOG_SYSTEM_EXAMPLE["endpoints"]),
                "framework": "FastAPI",
                "database": "MySQL",
            },
            {
                "id": "ecommerce",
                "name": "ì „ììƒê±°ë˜ ì‹œìŠ¤í…œ",
                "description": "ìƒí’ˆ, ì¥ë°”êµ¬ë‹ˆ, ì£¼ë¬¸ ê´€ë¦¬",
                "endpoints_count": len(ECOMMERCE_EXAMPLE["endpoints"]),
                "framework": "FastAPI",
                "database": "PostgreSQL",
            },
        ]
    }


@app.get("/api/examples/{example_id}")
async def get_example(example_id: str):
    """íŠ¹ì • ì˜ˆì œì˜ ìƒì„¸ ìŠ¤í™ ë°˜í™˜"""
    examples = {
        "user_management": USER_MANAGEMENT_EXAMPLE,
        "blog_system": BLOG_SYSTEM_EXAMPLE,
        "ecommerce": ECOMMERCE_EXAMPLE,
    }

    if example_id not in examples:
        raise HTTPException(status_code=404, detail="ì˜ˆì œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")

    return examples[example_id]


@app.post("/api/download")
async def download_generated_code(spec: APISpecModel):
    """ìƒì„±ëœ ì½”ë“œ íŒŒì¼ë“¤ì„ JSONìœ¼ë¡œ ë°˜í™˜ (ë‹¤ìš´ë¡œë“œìš©)"""
    try:
        result = code_generator.generate_api(spec)

        files = {
            "main.py": result.main_code,
            "models.py": result.models,
            "database.py": result.database,
            "requirements.txt": result.requirements,
            "README.md": result.documentation,
        }

        return {
            "success": True,
            "message": "ì½”ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤",
            "files": files,
            "project_name": spec.name.replace(" ", "_").lower(),
        }

    except Exception as e:
        raise HTTPException(status_code=500, detail=f"íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")


@app.get("/", response_class=HTMLResponse)
async def get_web_interface():
    """ì›¹ ì¸í„°í˜ì´ìŠ¤ HTML ë°˜í™˜"""
    return """
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REST API Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div x-data="apiGenerator()" class="max-w-7xl mx-auto p-6" x-init="init()">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸš€ REST API Generator</h1>
            <p class="text-lg text-gray-600">Python FastAPI ê¸°ë°˜ ìë™ REST API ìƒì„±ê¸°</p>
            <p class="text-sm text-gray-500 mt-2">3ê°€ì§€ ì‹¤ë¬´ ì˜ˆì œ í¬í•¨</p>
        </div>
        
        <!-- ì˜ˆì œ ì„ íƒ -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-center">ğŸ¯ ë¹ ë¥¸ ì‹œì‘ - ì˜ˆì œ ì„ íƒ</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <template x-for="example in examples" :key="example.id">
                    <div class="border-2 border-gray-200 rounded-lg p-6 hover:border-blue-400 hover:shadow-md transition-all cursor-pointer"
                         @click="loadExample(example.id)"
                         :class="selectedExample === example.id ? 'border-blue-500 bg-blue-50' : ''">
                        <h3 class="font-bold text-lg mb-2" x-text="example.name"></h3>
                        <p class="text-gray-600 text-sm mb-3" x-text="example.description"></p>
                        <div class="flex justify-between items-center text-xs">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded" 
                                  x-text="example.endpoints_count + 'ê°œ API'"></span>
                            <span class="text-gray-500" x-text="example.database"></span>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- ì„¤ì • íŒ¨ë„ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-6">âš™ï¸ API ì„¤ì •</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">API ì´ë¦„</label>
                        <input x-model="spec.name" 
                               type="text" 
                               placeholder="ì˜ˆ: My Awesome API"
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">ì„¤ëª…</label>
                        <textarea x-model="spec.description" 
                                  placeholder="APIì˜ ëª©ì ê³¼ ê¸°ëŠ¥ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”"
                                  class="w-full p-3 border border-gray-300 rounded-lg h-24 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">í”„ë ˆì„ì›Œí¬</label>
                            <select x-model="spec.framework" 
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="fastapi">ğŸ FastAPI</option>
                                <option value="flask">ğŸŒ¶ï¸ Flask</option>
                                <option value="express">ğŸ“— Express.js</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">ë°ì´í„°ë² ì´ìŠ¤</label>
                            <select x-model="spec.database" 
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="postgresql">ğŸ˜ PostgreSQL</option>
                                <option value="mysql">ğŸ¬ MySQL</option>
                                <option value="sqlite">ğŸ“± SQLite</option>
                                <option value="mongodb">ğŸƒ MongoDB</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">ì¸ì¦ ë°©ì‹</label>
                        <select x-model="spec.authentication" 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="none">ğŸš« ì¸ì¦ ì—†ìŒ</option>
                            <option value="jwt">ğŸ”‘ JWT</option>
                            <option value="oauth2">ğŸ” OAuth 2.0</option>
                            <option value="api-key">ğŸ—ï¸ API Key</option>
                        </select>
                    </div>
                </div>
                
                <button @click="generateAPI()" 
                        :disabled="isGenerating || !spec.name || !spec.description"
                        class="w-full mt-6 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all font-semibold text-lg shadow-lg">
                    <span x-show="!isGenerating">ğŸš€ API ìƒì„±í•˜ê¸°</span>
                    <span x-show="isGenerating" class="flex items-center justify-center">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        ìƒì„± ì¤‘...
                    </span>
                </button>
            </div>

            <!-- ê²°ê³¼ íŒ¨ë„ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-6">ğŸ“„ ìƒì„±ëœ ì½”ë“œ</h2>
                
                <div x-show="generatedCode && generatedCode.main_code">
                    <!-- íƒ­ -->
                    <div class="flex space-x-1 mb-4 bg-gray-100 p-1 rounded-lg">
                        <button @click="activeTab = 'main'" 
                                :class="activeTab === 'main' ? 'bg-white shadow' : 'hover:bg-gray-200'"
                                class="flex-1 px-3 py-2 rounded-md text-sm font-medium transition-all">
                            main.py
                        </button>
                        <button @click="activeTab = 'models'" 
                                :class="activeTab === 'models' ? 'bg-white shadow' : 'hover:bg-gray-200'"
                                class="flex-1 px-3 py-2 rounded-md text-sm font-medium transition-all">
                            models.py
                        </button>
                        <button @click="activeTab = 'database'" 
                                :class="activeTab === 'database' ? 'bg-white shadow' : 'hover:bg-gray-200'"
                                class="flex-1 px-3 py-2 rounded-md text-sm font-medium transition-all">
                            database.py
                        </button>
                    </div>
                    
                    <!-- ì½”ë“œ í‘œì‹œ -->
                    <div class="bg-gray-900 rounded-lg p-4 mb-4">
                        <pre class="text-green-400 text-xs overflow-auto h-80 whitespace-pre-wrap"><code x-text="getActiveTabContent()"></code></pre>
                    </div>
                    
                    <!-- ë‹¤ìš´ë¡œë“œ ë° ì‹¤í–‰ ì •ë³´ -->
                    <div class="space-y-3">
                        <button @click="downloadAll()" 
                                class="w-full bg-green-600 text-white p-3 rounded-lg hover:bg-green-700 transition-colors font-medium">
                            ğŸ“¥ ëª¨ë“  íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                        </button>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-medium text-blue-800 mb-2">ğŸƒâ€â™‚ï¸ ì‹¤í–‰ ë°©ë²•:</h4>
                            <ol class="text-sm text-blue-700 space-y-1">
                                <li>1. íŒŒì¼ë“¤ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ í”„ë¡œì íŠ¸ í´ë”ì— ì €ì¥</li>
                                <li>2. <code class="bg-blue-200 px-1 rounded">pip install -r requirements.txt</code></li>
                                <li>3. <code class="bg-blue-200 px-1 rounded">python main.py</code></li>
                                <li>4. http://localhost:8000/docs ì—ì„œ API ë¬¸ì„œ í™•ì¸</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <div x-show="!generatedCode || !generatedCode.main_code" class="text-center py-16">
                    <div class="text-6xl mb-4">ğŸ› ï¸</div>
                    <p class="text-gray-500 text-lg">ì˜ˆì œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì„¤ì •ì„ ì…ë ¥í•˜ê³ <br>ìƒì„± ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</p>
                </div>
            </div>
        </div>

        <!-- ì„±ê³µ ë©”ì‹œì§€ -->
        <div x-show="showSuccess" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-2"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             class="fixed bottom-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg">
            âœ… API ì½”ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!
        </div>
    </div>

    <script>
        function apiGenerator() {
            return {
                spec: {
                    name: '',
                    description: '',
                    version: '1.0.0',
                    framework: 'fastapi',
                    database: 'postgresql',
                    authentication: 'jwt',
                    endpoints: []
                },
                examples: [],
                generatedCode: null,
                isGenerating: false,
                activeTab: 'main',
                selectedExample: null,
                showSuccess: false,
                
                async init() {
                    await this.loadExamples();
                },
                
                async loadExamples() {
                    try {
                        const response = await fetch('/api/examples');
                        const data = await response.json();
                        this.examples = data.examples;
                    } catch (error) {
                        console.error('ì˜ˆì œ ë¡œë“œ ì‹¤íŒ¨:', error);
                    }
                },
                
                async loadExample(exampleId) {
                    try {
                        this.selectedExample = exampleId;
                        const response = await fetch(`/api/examples/${exampleId}`);
                        const data = await response.json();
                        this.spec = { ...data };
                    } catch (error) {
                        console.error('ì˜ˆì œ ë¡œë“œ ì‹¤íŒ¨:', error);
                        alert('ì˜ˆì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                },
                
                async generateAPI() {
                    if (!this.spec.name || !this.spec.description) {
                        alert('API ì´ë¦„ê³¼ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    this.isGenerating = true;
                    try {
                        const response = await fetch('/api/generate', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.spec)
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.detail || 'API ìƒì„± ì‹¤íŒ¨');
                        }
                        
                        this.generatedCode = await response.json();
                        this.showSuccessMessage();
                        
                    } catch (error) {
                        console.error('API ìƒì„± ì˜¤ë¥˜:', error);
                        alert('API ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    } finally {
                        this.isGenerating = false;
                    }
                },
                
                getActiveTabContent() {
                    if (!this.generatedCode) return '';
                    
                    switch(this.activeTab) {
                        case 'main': return this.generatedCode.main_code || '';
                        case 'models': return this.generatedCode.models || '';
                        case 'database': return this.generatedCode.database || '';
                        default: return '';
                    }
                },
                
                async downloadAll() {
                    try {
                        const response = await fetch('/api/download', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.spec)
                        });
                        
                        if (!response.ok) {
                            throw new Error('ë‹¤ìš´ë¡œë“œ ìš”ì²­ ì‹¤íŒ¨');
                        }
                        
                        const data = await response.json();
                        
                        // ê° íŒŒì¼ì„ ê°œë³„ì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ
                        Object.entries(data.files).forEach(([filename, content]) => {
                            this.downloadFile(filename, content);
                        });
                        
                    } catch (error) {
                        console.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                        alert('íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    }
                },
                
                downloadFile(filename, content) {
                    const element = document.createElement('a');
                    const file = new Blob([content], { type: 'text/plain' });
                    element.href = URL.createObjectURL(file);
                    element.download = filename;
                    document.body.appendChild(element);
                    element.click();
                    document.body.removeChild(element);
                },
                
                showSuccessMessage() {
                    this.showSuccess = true;
                    setTimeout(() => {
                        this.showSuccess = false;
                    }, 3000);
                }
            }
        }
    </script>
</body>
</html>
"""


# ============================================================================
# 5. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ë¶€
# ============================================================================

if __name__ == "__main__":
    print("ğŸš€ REST API Generator ì‹œì‘!")
    print("=" * 50)
    print("ğŸ“– API ë¬¸ì„œ: http://localhost:8000/docs")
    print("ğŸŒ ì›¹ ì¸í„°í˜ì´ìŠ¤: http://localhost:8000")
    print("ğŸ“‹ ì˜ˆì œ API: http://localhost:8000/api/examples")
    print("=" * 50)
    print("ğŸ’¡ ì‚¬ìš©ë²•:")
    print("1. ì›¹ ë¸Œë¼ìš°ì €ë¡œ http://localhost:8000 ì ‘ì†")
    print("2. ì˜ˆì œ ì¤‘ í•˜ë‚˜ ì„ íƒ ë˜ëŠ” ì§ì ‘ ì„¤ì •")
    print("3. 'API ìƒì„±í•˜ê¸°' ë²„íŠ¼ í´ë¦­")
    print("4. ìƒì„±ëœ ì½”ë“œ ë‹¤ìš´ë¡œë“œ ë° ì‹¤í–‰")
    print("=" * 50)

    uvicorn.run("main1:app", host="0.0.0.0", port=8000, reload=True)
